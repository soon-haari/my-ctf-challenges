<!DOCTYPE html>
<html>
<head>
    <link rel="icon" href="/static/rose.webp" type="image/x-icon">
    <title>Pick a number!</title>
    <meta charset="utf-8">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Fira+Code&display=swap" rel="stylesheet">
    <style>
        body {
            background-color: #000;
            color: #0f0;
            font-family: 'Press Start 2P', monospace;
            text-align: center;
            padding-top: 50px;
        }

        h2 {
            font-size: 1.5em;
            margin-bottom: 20px;
            text-shadow: 0 0 10px #0f0;
        }

        form {
            margin-bottom: 20px;
        }

        input[type="text"] {
            background: #111;
            color: #0f0;
            border: 2px solid #0f0;
            padding: 10px;
            width: 300px;
            font-family: inherit;
        }

        button {
            background: #0f0;
            color: #000;
            border: none;
            padding: 10px 20px;
            margin-top: 10px;
            font-family: inherit;
            cursor: pointer;
            box-shadow: 0 0 10px #0f0;
            transition: 0.2s;
        }

        button:hover {
            background: #1f1;
            box-shadow: 0 0 20px #0f0;
        }

        #source {
            margin-top: 30px;
            white-space: pre-wrap;
            background: #111;
            color: #0f0;
            border: 1px solid #0f0;
            padding: 20px;
            display: none;
            max-width: 90%;
            margin-left: auto;
            margin-right: auto;
            text-align: left;
            overflow-x: auto;
            font-family: 'Fira Code', monospace;
            font-size: 12px;
        }

        @keyframes float {
            0%   { transform: translateY(0); }
            50%  { transform: translateY(-10px); }
            100% { transform: translateY(0); }
        }

        #result {
            margin-top: 20px;
            font-size: 14px;
            color: #0ff;
            font-family: 'Press Start 2P', monospace;
            white-space: pre-wrap;
            animation: float 2s ease-in-out infinite;
            transition: all 0.3s ease-in-out;
        }


        .star {
            position: fixed;
            pointer-events: none;
            opacity: 0;
            animation: fadeOut 2s ease-out forwards;
        }

        @keyframes fadeOut {
            0% {
                opacity: 1;
                transform: scale(var(--scale, 1));
            }
            100% {
                opacity: 0;
                transform: scale(calc(var(--scale, 1) * 1.2));
            }
        }

         #bestScore { display: inline-flex; align-items: center; gap: 8px; white-space: normal; }
        .trophy { height: 60px; vertical-align: middle; image-rendering: pixelated; }

        #snow {
            position: fixed;
            inset: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none;
            z-index: 9999;
        }
        #ground {
            position: fixed;
            bottom: calc(50px);
            transform: translateY(35%);

            left: 0;
            width: 100vw;
            height: auto;

            pointer-events: none;
            z-index: 10;
        }


    </style>
</head>

<script>
    function spawnStar() {
        const star = document.createElement("img");
        let isStar = false;

        const r = Math.random() * 3;
        if (r > 1){
            star.src = "/static/star.png";
            isStar = true;
        } else if (r > 3/4) {
            star.src = "/static/soon.png";
        } else if (r > 2/4) {
            star.src = "/static/socks.png";
        } else if (r > 1/4) {
            star.src = "/static/present.png";
        } else {
            star.src = "/static/hat.webp";
        } 

        star.className = "star";
        star.className = "star";

        size = 16 + Math.random() * 240;
        if (!isStar){
            size *= 0.7
        }
        const x = Math.random() * window.innerWidth;
        const y = Math.random() * window.innerHeight;
        const scale = 0.5 + Math.random() * 1.5;
        const duration = (!isStar) ? 8 : 1.0 + Math.random() * 3.0;

        star.style.left = `${x}px`;
        star.style.top = `${y}px`;
        star.style.width = `${size}px`;
        star.style.setProperty('--scale', scale);

        document.body.appendChild(star);

        setTimeout(() => {
            star.remove();
        }, duration * 1000);
    }

    setInterval(spawnStar, 300);
</script>


<body>
    <img id="ground" src="/static/ground.png" alt="" />

    <canvas id="snow" aria-hidden="true"></canvas>

    <h2>
      HammingDiet
      <img src="/static/rose.png" alt="rose"
     style="
        height: 2em;
        vertical-align: middle;
        image-rendering: pixelated;
        filter: brightness(3) drop-shadow(0 0 6px #0f0);
        margin-top: -18px;
        margin-left: -15px;
     ">


    </h2>

    <pre id="result" style="white-space: pre-wrap;"></pre>

    <div id="bestScore" style="margin-top: 20px; font-size: 20px; color: #0ff; white-space: pre-wrap;"></div>

    <div id="blood" style="margin-top: 20px; font-size: 20px; color: #0ff; white-space: pre-wrap;"><img src="/static/blood.png" alt="trophy" class="trophy"> shpark <img src="/static/blood.png" alt="trophy" class="trophy"></div>

    <div style="text-align: center; margin-top: 10px;">
        <button onclick="toggleSource()">ðŸ“œ View Source</button>
    </div>
    <pre id="source"></pre>

    <script>
        async function toggleSource() {
            const el = document.getElementById("source");
            if (getComputedStyle(el).display === "none") {
                const res = await fetch("/source");
                const text = await res.text();
                el.textContent = text;
                el.style.display = "block";
            } else {
                el.style.display = "none";
            }
        }

        async function loadBestScore() {
            try {
                const res = await fetch("/load");
                if (!res.ok) return;
                const data = await res.json();
                const bestBox = document.getElementById("bestScore");
                bestBox.innerHTML = `<img src="/static/trophy.png" alt="trophy" class="trophy">` +
                      `${data.username}: ${data.score}` +
                      `<img src="/static/trophy.png" alt="trophy" class="trophy">`;
            } catch (e) {
                console.error("Failed to load best score:", e);
            }
        }

        window.addEventListener("DOMContentLoaded", loadBestScore);

    </script>

    <script>
    (function () {
        const canvas = document.getElementById("snow");
        const ctx = canvas.getContext("2d", { alpha: true });

        function resize() {
            const dpr = window.devicePixelRatio || 1;
            canvas.width = window.innerWidth * dpr;
            canvas.height = window.innerHeight * dpr;
            canvas.style.width = window.innerWidth + "px";
            canvas.style.height = window.innerHeight + "px";
            ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
        }
        window.addEventListener("resize", resize);
        resize();

        const flakes = [];
        const N = 180;

        const rand = (a, b) => a + Math.random() * (b - a);

        for (let i = 0; i < N; i++) {
            flakes.push({
                x: rand(0, innerWidth),
                y: rand(-innerHeight, 0),
                r: rand(0.8, 5.8),
                vx: rand(-0.3, 0.3),
                vy: rand(0.6, 2.0),
                phase: rand(0, Math.PI * 2),
                alpha: rand(0.4, 0.9)
            });
        }

        function draw() {
            ctx.clearRect(0, 0, innerWidth, innerHeight);
            for (const f of flakes) {
                f.phase += 0.01;
                f.x += f.vx + Math.sin(f.phase) * 0.2;
                f.y += f.vy;

                if (f.y > innerHeight) {
                    f.y = -10;
                    f.x = rand(0, innerWidth);
                }

                ctx.globalAlpha = f.alpha;
                ctx.beginPath();
                ctx.arc(f.x, f.y, f.r, 0, Math.PI * 2);
                ctx.fillStyle = "#fff";
                ctx.fill();
            }
            ctx.globalAlpha = 1;
            requestAnimationFrame(draw);
        }
        draw();
    })();
</script>

</body>
</html>
